generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
}

model HealthCheck {
  id String @id @default(uuid())
}

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String
  role      Role
  createdAt DateTime @default(now())

  contests      Contest[] @relation("CreatorContests")
  mcqSubs       McqSubmission[]
  dsaSubs       DsaSubmission[]
}


model Contest {
  id          String   @id @default(uuid())
  title       String
  description String
  creatorId   String
  startTime   DateTime
  endTime     DateTime
  createdAt   DateTime @default(now())

  creator     User @relation("CreatorContests", fields: [creatorId], references: [id])
  mcqs        McqQuestion[]
  dsaProblems DsaProblem[]  
}


model McqQuestion {
  id        String   @id @default(uuid())
  contestId String
  question  String
  options   Json
  correctIndex Int
  points    Int      @default(1)
  createdAt DateTime @default(now())

  contest Contest @relation(fields: [contestId], references: [id])
  submissions  McqSubmission[]
}


model DsaProblem {
  id           String   @id @default(uuid())
  contestId    String
  title        String
  description  String
  tags         Json
  points       Int      @default(100)
  timeLimit    Int      @default(2000)
  memoryLimit  Int      @default(256)
  createdAt    DateTime @default(now())

  contest   Contest    @relation(fields: [contestId], references: [id])
  testCases TestCase[]
  submissions DsaSubmission[]
}

model TestCase {
  id        String   @id @default(uuid())
  problemId String
  input     String
  output    String
  isHidden  Boolean  @default(false)
  createdAt DateTime @default(now())

  problem DsaProblem @relation(fields: [problemId], references: [id])
}


model McqSubmission {
  id        String   @id @default(uuid())
  userId    String
  questionId String
  selectedIndex Int
  isCorrect Boolean
  pointsEarned Int
  submittedAt DateTime @default(now())

  user     User        @relation(fields: [userId], references: [id])
  question McqQuestion @relation(fields: [questionId], references: [id])

  @@unique([userId, questionId])
}

model DsaSubmission {
  id        String   @id @default(uuid())
  userId    String
  problemId String
  code      String
  language  String
  status    String
  pointsEarned Int
  passed    Int
  total     Int
  execTime  Int
  submittedAt DateTime @default(now())

  user    User       @relation(fields: [userId], references: [id])
  problem DsaProblem @relation(fields: [problemId], references: [id])
}

enum Role {
  creator
  contestee
}
